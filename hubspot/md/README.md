é¸®é¸®é—®å¾—å¥½ï¼Œè¿™ä¿©è„šæœ¬è™½ç„¶åå­—ç›¸ä¼¼ï¼Œä½†åŠŸèƒ½å…¶å®æ˜¯**ä¸€å¥—ç»„åˆæ‹³**ï¼Œåˆ†åˆ«è´Ÿè´£ HubSpot æ“ä½œæµç¨‹ä¸­çš„ä¸¤ä¸ªé˜¶æ®µï¼Œä¸€èµ·æ‰èƒ½å®Œæˆâ€œç”¨é‚®ç®±æŸ¥æ‰¾è”ç³»äºº â†’ å†™å…¥ç¬”è®°â€çš„é—­ç¯ï¼

---

## ğŸ’¡ ç®€æ˜åŒºåˆ«è¯´æ˜

| è„šæœ¬å                       | ä¸»è¦åŠŸèƒ½                         | æ˜¯å¦æä¾›æ¥å£        | é€‚ç”¨åœºæ™¯                            |
| ------------------------- | ---------------------------- | ------------- | ------------------------------- |
| `hubspot_note_writer.py`  | âœï¸ çœŸæ­£æ‰§è¡Œâ€œå†™å…¥ç¬”è®°â€åˆ° HubSpot çš„æ ¸å¿ƒå‡½æ•° | âŒ çº¯å‡½æ•°æ¨¡å—       | ç»™å®š contact\_id å’Œå†…å®¹ï¼Œå†™å…¥ç¬”è®°         |
| `hubspot_notes_writer.py` | ğŸŒ æä¾› FastAPI æ¥å£ï¼ˆé€‚é… n8nï¼‰     | âœ… æä¾› HTTP API | æ”¯æŒä½ é€šè¿‡ email è‡ªåŠ¨æ‰¾ contact â†’ å†™å¤šæ¡ç¬”è®° |

---

## ğŸ§  æ›´ç»†ä¸€ç‚¹çš„åŠŸèƒ½æ‹†åˆ†

### 1. `hubspot_note_writer.py`

ä½ å¯ä»¥ç†è§£ä¸ºè¿™æ˜¯â€œåç«¯å†™æ•°æ®åº“â€çš„æ‰§è¡Œè€…ï¼Œå®ƒåªåšä¸€ä»¶äº‹ï¼š

> **ç”¨ HubSpot APIï¼Œå‘æŸä¸ªè”ç³»äººï¼ˆç”¨ contact\_id æŒ‡å®šï¼‰å†™ä¸€æ¡ `hs_note_body` ç¬”è®°ã€‚**

**æ ¸å¿ƒå‡½æ•°**ï¼š

```python
def write_note(contact_id: str, note_content: str) -> dict
```

é€‚ç”¨äºä½ å·²ç»çŸ¥é“ contact\_idï¼Œè¦ç›´æ¥å†™å…¥å†…å®¹æ—¶ï¼ˆä¾‹å¦‚åœ¨åå°å¾ªç¯å¤„ç†æ—¶è°ƒç”¨ï¼‰ã€‚

---

### 2. `hubspot_notes_writer.py`

è¿™æ˜¯ä½ çš„ **API å°è£…å±‚**ï¼Œç”¨äºæ¥å…¥è‡ªåŠ¨åŒ–å·¥å…·ï¼ˆå¦‚ n8nï¼‰ï¼Œå®ƒä¼šï¼š

1. **é€šè¿‡ email è°ƒç”¨æœç´¢æ¥å£** â†’ å¾—åˆ° contact\_id
2. **å¤šå°ä¿¡æ—¶å¾ªç¯å†™å…¥ç¬”è®°** â†’ è°ƒç”¨ `write_note(...)`
3. **æä¾› POST æ¥å£**ï¼Œä¾›å‰ç«¯æˆ– n8n ç­‰è§¦å‘

ä¾‹å¦‚ï¼Œå®ƒå¯èƒ½åŒ…å«è¿™ä¸ªæ¥å£é€»è¾‘ï¼ˆæ­£åœ¨æ„å»ºä¸­ï¼‰ï¼š

```python
@app.post("/write_notes_by_email")
async def write_notes_by_email(email: str, replies: List[str]):
    # 1. æŸ¥ contact_id
    # 2. å¤šæ¬¡è°ƒç”¨ write_note(contact_id, reply)
```

---

## ğŸ”§ ä¸ºä»€ä¹ˆåˆ†å¼€å†™ï¼Ÿ

æ¨¡å—åŒ–çš„è®¾è®¡å¯ä»¥è®©ä½ ï¼š

* âœ… åœ¨è‡ªåŠ¨åŒ– API åœºæ™¯ä¸­å¤ç”¨é€»è¾‘ï¼ˆæ¯”å¦‚ POST æ¥å£ï¼‰
* âœ… åœ¨è„šæœ¬æˆ–æ‰¹é‡å¤„ç†æ—¶ç›´æ¥è°ƒç”¨åº•å±‚ `write_note`
* âœ… ä¾¿äºæµ‹è¯•å’Œæ‰©å±•ï¼ˆæ¯”å¦‚ä»¥åå†™é™„ä»¶ã€ä»»åŠ¡ç­‰ï¼‰

---

å¦‚æœä½ éœ€è¦ï¼Œæˆ‘å¯ä»¥å¸®ä½ å†ç”»ä¸ªå›¾è¡¨å±•ç¤ºâ€œè°ƒç”¨æµç¨‹å›¾â€ï¼Œæˆ–è€…ç›´æ¥åˆå¹¶æˆä¸€ä¸ªæ–‡ä»¶åšæˆå•æ–‡ä»¶ç‰ˆä¹Ÿæ²¡é—®é¢˜ï¼éœ€è¦æˆ‘æ¥ç»§ç»­æ•´åˆ FastAPI è·¯ç”±é‚£éƒ¨åˆ†å—ï¼Ÿ


å¥½çš„ï¼ä½ åˆšåˆšå‘çš„è¿™æ®µ `hubspot_oauth_server.py` æ˜¯ä¸€ä»½å¾ˆå¹²å‡€ã€åŠŸèƒ½æ˜ç¡®çš„ **HubSpot OAuth æˆæƒå’Œ token ç®¡ç†å·¥å…·æ¨¡å—**ã€‚

å¦å¦æ¥é€æ®µç»™ä½  **è¯¦ç»†æ‹†è§£ + ä¸­æ–‡æ³¨é‡Šè®²è§£**ï¼Œè®©ä½ å½»åº•æ˜ç™½ï¼š

---

# ğŸŒ è„šæœ¬åç§°

```python
# filename: hubspot_oauth_server.py
```

---

## ğŸ”§ å¯¼å…¥æ¨¡å—

```python
from fastapi import Request
import requests, os, json
from datetime import datetime, timedelta
```

* `Request`: FastAPI çš„è¯·æ±‚å¯¹è±¡ï¼Œç”¨äºè¯»å– URL ä¸­çš„å‚æ•°ï¼ˆå¦‚ codeï¼‰
* `requests`: ç”¨æ¥è°ƒç”¨ HubSpot çš„ HTTP API
* `os`, `json`: ç”¨äºä¿å­˜ token æ–‡ä»¶
* `datetime`, `timedelta`: ç”¨æ¥åˆ¤æ–­ token æ˜¯å¦è¿‡æœŸ

---

## ğŸ” é…ç½®å‚æ•°ï¼ˆClient ä¿¡æ¯ + token è·¯å¾„ï¼‰

```python
CLIENT_ID = "6d980ab9-5759-42a1-a7d4-cab1caa5e74b"
CLIENT_SECRET = "b26c391d-7db2-45fd-b657-6449132f34bb"
REDIRECT_URI = "http://localhost:8000/hubspot/oauth/callback"
TOKEN_PATH = os.path.join("data", "token.json")
```

* `CLIENT_ID / SECRET`: HubSpot åº”ç”¨çš„èº«ä»½å‡­è¯
* `REDIRECT_URI`: æˆæƒå®Œæˆåå›è°ƒåˆ°ä½ çš„ FastAPI è·¯å¾„
* `TOKEN_PATH`: æœ¬åœ° token å­˜å‚¨è·¯å¾„

---

## âœ… æ ¸å¿ƒå‡½æ•° 1ï¼šè·å–æœ‰æ•ˆçš„ access\_token

```python
def get_valid_access_token():
```

### ğŸ‘‡é€»è¾‘åˆ†è§£

1. **è¯»å–æœ¬åœ° token æ–‡ä»¶**ï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨
2. æå–å…¶ä¸­çš„å­—æ®µï¼š`access_token`ã€`refresh_token`ã€`expires_in`ã€`fetched_at`
3. ç”¨ `fetched_at + expires_in` è®¡ç®—æ˜¯å¦å·²è¿‡æœŸ
4. å¦‚æœè¿‡æœŸï¼Œåˆ™ï¼š

   * ç”¨ `refresh_token` è‡ªåŠ¨åˆ·æ–°
   * è¦†ç›– `token.json`
5. è¿”å›æœ‰æ•ˆçš„ `access_token`

è¿™æ˜¯æ•´ä¸ªç³»ç»Ÿçš„â€œå¿ƒè„â€ï¼Œä½ æ¯æ¬¡è°ƒç”¨ HubSpot API éƒ½ä¾èµ–è¿™ä¸ªå‡½æ•°ã€‚

---

## âœ… æ ¸å¿ƒå‡½æ•° 2ï¼šå¤„ç† OAuth å›è°ƒ

```python
async def hubspot_callback(request: Request):
```

è¿™æ˜¯ä½ åœ¨å®Œæˆ OAuth ç™»å½•åï¼ŒHubSpot å›è°ƒä½ ç”¨çš„æ¥å£ã€‚

### ğŸ‘‡é€»è¾‘ï¼š

1. ä»å›è°ƒ URL ä¸­æå– `code`
2. ç”¨ `code + client_secret` æ¢å– access\_token
3. æŠŠæ¢åˆ°çš„ token ä¿å­˜æˆ `token.json`
4. æ·»åŠ ä¸€ä¸ª `fetched_at` æ—¶é—´æˆ³ï¼Œæ–¹ä¾¿åç»­åˆ¤æ–­æ˜¯å¦è¿‡æœŸ

è¿™ä¸ªå‡½æ•°ä½ åœ¨ `app.py` é‡Œæ³¨å†Œä¸ºï¼š

```python
app.add_api_route("/hubspot/oauth/callback", hubspot_callback, methods=["GET"])
```

---

## âœ… æ ¸å¿ƒå‡½æ•° 3ï¼šæ‰‹åŠ¨åˆ·æ–° tokenï¼ˆè°ƒè¯•ç”¨ï¼‰

```python
def refresh_access_token_manual():
```

è¿™ä¸ªå‡½æ•°æä¾›ä¸€ä¸ªå¤‡ç”¨æ‰‹æ®µï¼šå¦‚æœä½ ä¸æƒ³ç­‰ token è¿‡æœŸæ‰åˆ·æ–°ï¼Œå°±å¯ä»¥ç›´æ¥æ‰‹åŠ¨è°ƒç”¨ã€‚

1. ä» `token.json` é‡Œå–å‡º `refresh_token`
2. è°ƒç”¨ HubSpot API åˆ·æ–° token
3. ä¿å­˜æ–°çš„ token å¹¶æ›´æ–° `fetched_at`

---

## âœ… æ€»ç»“åŠŸèƒ½ç»“æ„å›¾ï¼š

```text
[ç”¨æˆ·ç‚¹å‡»æˆæƒ] â†’ [HubSpot é‡å®šå‘å›æ¥å¸¦ code]
                            â†“
                 hubspot_callback(code) 
                            â†“
              POST æ¢ access_token + ä¿å­˜
                            â†“
           get_valid_access_token() â†’ æ¯æ¬¡ç”¨æ—¶è‡ªåŠ¨æ£€æµ‹æ˜¯å¦è¿‡æœŸ â†’ è‡ªåŠ¨ refresh
                            â†“
            å…¶å®ƒæ¨¡å—ç›´æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°è·å– token å°±è¡Œ âœ…
```

---

## âœ… ä½ ç°åœ¨è¿™ä¸ªè„šæœ¬æ”¯æŒçš„èƒ½åŠ›

| èƒ½åŠ›           | è¯´æ˜                             |
| ------------ | ------------------------------ |
| âœ… è‡ªåŠ¨åˆ·æ–° token | ç”¨äºé•¿æœŸè®¿é—® HubSpot API             |
| âœ… å›è°ƒå‡½æ•°æ³¨å†Œ     | æ­£å¸¸æ¥æ”¶ OAuth code å¹¶æ¢ token       |
| âœ… å¯è¢«å…¶å®ƒæ¥å£è°ƒç”¨   | æ¯”å¦‚å†™ noteã€è·å–è”ç³»äººéƒ½å¯ç”¨              |
| âœ… æ”¯æŒæœ¬åœ°å­˜å‚¨     | æ‰€æœ‰ token å­˜å‚¨åœ¨ `data/token.json` |

---


### âœ… å½“å‰ FastAPI åº”ç”¨èƒ½åŠ›æ±‡æ€»ï¼š

| æ¥å£     | è·¯å¾„                              | åŠŸèƒ½æè¿°                           |
| ------ | ------------------------------- | ------------------------------ |
| `GET`  | `/hubspot/list_contacts_simple` | âœ… è·å–è”ç³»äººåˆ—è¡¨ï¼ˆå«IDã€å§“åã€é‚®ç®±ï¼‰           |
| `GET`  | `/hubspot/get_token_scopes`     | âœ… æŸ¥çœ‹å½“å‰ OAuth token æƒé™          |
| `GET`  | `/hubspot/list_contact_fields`  | âœ… è·å–è”ç³»äººå­—æ®µåï¼ˆå‡†å¤‡â€œç¼–è¾‘è”ç³»äººâ€ç”¨ï¼‰         |
| `POST` | `/hubspot/ai_followup_note`     | âœ… è‡ªåŠ¨ç”Ÿæˆ AI è·Ÿè¿›å†…å®¹å¹¶å†™å…¥ HubSpot Note |
| `GET`  | `/hubspot/oauth/callback`       | ğŸ” æˆæƒå®Œæˆåçš„å›è°ƒé€»è¾‘                  |



---

### ğŸ§  ä½ å¯èƒ½åœ¨é—®ï¼š

> â€œé‚£è¿™äº›åŠŸèƒ½è·Ÿæˆ‘ä¸€å¼€å§‹è¯´çš„ *AIèƒ½æ“ä½œHubSpotè”ç³»äºº* æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿâ€

ç­”ï¼šä½ ç°åœ¨å°±æ˜¯åœ¨ **ä¸€æ­¥æ­¥åœ°æ„å»ºè¿™ä¸ª AI èƒ½åŠ›é“¾æ¡**ï¼š

1. âœ… è·å–è”ç³»äººä¿¡æ¯ â†’ ä¾› AI è¯†åˆ«ä¸Šä¸‹æ–‡å’Œç”¨æˆ·å¯¹è±¡
2. âœ… è·å–å­—æ®µåˆ—è¡¨ â†’ çŸ¥é“å¯ä»¥â€œä¿®æ”¹å“ªäº›å†…å®¹â€
3. âœ… å…·å¤‡å†™å…¥æƒé™ â†’ èƒ½çœŸæ­£å» HubSpot æ”¹å˜è”ç³»äºº
4. âœ… ç”¨ AI ç”Ÿæˆå†…å®¹æˆ–åˆ¤æ–­ â†’ è®©è‡ªåŠ¨åŒ–å˜å¾—â€œæœ‰è„‘å­â€


# æ€»ç»“ä¸€ä¸‹ get_contact_id_by_email(email) ä¸ä½ ç°æœ‰çš„ list_contacts_simple() ä¸¤è€…çš„åŒºåˆ«ä¸è”ç³»


| å‡½æ•°å                              | ç”¨é€”                       | ç»“æœ          | æŸ¥è¯¢æ–¹å¼                            |
| -------------------------------- | ------------------------ | ----------- | ------------------------------- |
| `list_contacts_simple()`         | **åˆ—å‡ºå¤šä¸ªè”ç³»äºº**ï¼Œå« id å’Œ email | è¿”å›ä¸€ä¸ªè”ç³»äººåˆ—è¡¨   | éå†æ‰€æœ‰è”ç³»äººï¼ˆåˆ†é¡µåˆ—è¡¨ï¼‰                   |
| `get_contact_id_by_email(email)` | **æŸ¥æ‰¾å•ä¸ªè”ç³»äºº**çš„ IDï¼Œä¾æ® email | åªè¿”å›ä¸€ä¸ªè”ç³»äºº ID | ç”¨ HubSpot çš„ **search API ç²¾ç¡®æœç´¢** |



å¥½è€¶ï¼ğŸ‰æ—¢ç„¶ä½ æˆåŠŸäº†ï¼Œé‚£æˆ‘ç°åœ¨å°±æ¥ä¸ºä½ **å…¨é¢é€æ®µè§£æ**è¿™ä¸ª `hubspot_notes_writer.py` æ–‡ä»¶çš„ä½œç”¨å’Œé€»è¾‘ç»“æ„ï¼Œå¸¦ä½ å®Œæ•´ç†è§£å®ƒæ˜¯å¦‚ä½•\*\*ä»é‚®ä»¶å†…å®¹ JSON å†™å…¥ HubSpot è”ç³»äººç¬”è®°ï¼ˆNoteï¼‰\*\*çš„ âœ¨

---

## âœ… é¡¹ç›®ç›®æ ‡å›é¡¾ï¼š

æˆ‘ä»¬è¦å®ç°çš„æ˜¯ï¼š

> ğŸš€ **æ ¹æ®ç”¨æˆ·é‚®ç®±ï¼ŒæŠŠå¤šå°å¸¦æ—¶é—´æˆ³çš„é‚®ä»¶å†…å®¹æ‰¹é‡å†™å…¥åˆ° HubSpot å¯¹åº”è”ç³»äººçš„ Note é‡Œï¼Œå¹¶è®°å½•å†™å…¥æ˜¯å¦æˆåŠŸã€‚**

---

## ğŸ§© ä¸€ã€å¯¼å…¥ä¾èµ–æ¨¡å—

```python
import requests, os, json
from fastapi import APIRouter, HTTPException, Request
from hubspot.hubspot_oauth_server import get_valid_access_token
from hubspot.hubspot_contact_tools import get_contact_id_by_email
from datetime import datetime
```

### âœ… è§£é‡Šï¼š

* `requests`ï¼šç”¨äºå‘é€ HTTP è¯·æ±‚åˆ° HubSpot APIã€‚
* `APIRouter`ï¼šFastAPI çš„è·¯ç”±æœºåˆ¶ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªåŠŸèƒ½æ³¨å†Œæˆä¸€ä¸ª POST æ¥å£ `/upload-notes-by-email`ã€‚
* `get_valid_access_token()`ï¼šä» token æ–‡ä»¶ä¸­è¯»å– access\_tokenï¼Œå¦‚æœè¿‡æœŸå°±è‡ªåŠ¨åˆ·æ–°ï¼ˆç”±ä½ ä¹‹å‰å†™çš„ `hubspot_oauth_server.py` æä¾›ï¼‰ã€‚
* `get_contact_id_by_email()`ï¼šé€šè¿‡é‚®ç®±æŸ¥æ‰¾è”ç³»äººçš„å”¯ä¸€ HubSpot IDã€‚
* `datetime`ï¼šå°†æ—¶é—´æˆ³ä»å­—ç¬¦ä¸²ï¼ˆISOæ ¼å¼ï¼‰è½¬æˆ HubSpot éœ€è¦çš„æ¯«ç§’æ•°ï¼ˆUNIX epoch æ¯«ç§’æ—¶é—´æˆ³ï¼‰ã€‚

---

## ğŸ§© äºŒã€æ ¸å¿ƒå‡½æ•°ï¼šå†™å…¥ä¸€æ¡ç¬”è®° `write_note()`

```python
def write_note(contact_id: str, note_content: str, timestamp: int):
```

#### âœ… å‚æ•°è¯´æ˜ï¼š

* `contact_id`: HubSpot ä¸ŠæŸä¸ªè”ç³»äººçš„ IDï¼ˆä¸æ˜¯ emailï¼Œè€Œæ˜¯å†…éƒ¨å”¯ä¸€æ ‡è¯†ç¬¦ï¼‰
* `note_content`: ä¸€æ¡ç¬”è®°å†…å®¹
* `timestamp`: è¿™æ¡ç¬”è®°çš„æ—¶é—´ï¼ˆHubSpot å†…éƒ¨è¦æ±‚æ˜¯æ¯«ç§’ä¸ºå•ä½çš„æ•´æ•°ï¼‰

#### âœ… è¯·æ±‚æ„é€ ï¼š

```python
payload = {
    "properties": {
        "hs_note_body": note_content,
        "hs_timestamp": timestamp
    },
    "associations": [
        {
            "to": {
                "id": contact_id
            },
            "types": [
                {
                    "associationCategory": "HUBSPOT_DEFINED",
                    "associationTypeId": 202
                }
            ]
        }
    ]
}
```

* `"hs_note_body"`ï¼šæ˜¯ç¬”è®°çš„æ­£æ–‡ã€‚
* `"hs_timestamp"`ï¼šæ˜¯ç¬”è®°çš„åˆ›å»ºæ—¶é—´ï¼Œå¿…é¡»æ˜¯æ¯«ç§’æ•°ï¼ˆUNIX æ—¶é—´æˆ³ Ã— 1000ï¼‰ã€‚
* `"associationTypeId": 202`ï¼šæ˜¯ HubSpot å®šä¹‰çš„\*\*â€œè”ç³»äºº Note å…³è”â€\*\*çš„å›ºå®šç¼–å·ã€‚

#### âœ… å‘é€ POST è¯·æ±‚ï¼š

```python
url = "https://api.hubapi.com/crm/v3/objects/notes"
```

è°ƒç”¨ `HubSpot CRM Notes API` æ¥å†™å…¥ä¸€æ¡ç¬”è®°ã€‚

---

## ğŸ§© ä¸‰ã€æ¥å£å®šä¹‰ï¼š`@router.post("/upload-notes-by-email")`

è¿™ä¸ªæ˜¯ä½ ç³»ç»Ÿæš´éœ²å‡ºæ¥çš„ **HTTP æ¥å£**ï¼Œæ¥å—ç”¨æˆ·ä¸Šä¼ çš„å¤šå°é‚®ä»¶å†…å®¹ã€‚

### ğŸ”§ è¾“å…¥æ•°æ®ç»“æ„ï¼š

```json
[
  {
    "email": "abc@domain.com",
    "notes": [
      {
        "content": "é‚®ä»¶å†…å®¹",
        "timestamp": "2025-07-29T09:00:00Z"
      }
    ]
  }
]
```

---

## ğŸ§© å››ã€æ ¸å¿ƒå¤„ç†é€»è¾‘

```python
data = await request.json()
success = []
failed = []
```

### âœ… éå†æ¯ä¸ªè”ç³»äºº entryï¼š

```python
for entry in data:
    email = entry.get("email")
    notes = entry.get("notes", [])
```

1. **æ£€æŸ¥é‚®ç®±å’Œ notes æ˜¯å¦å®Œæ•´**ï¼Œå¦åˆ™è®°å½•å¤±è´¥ã€‚
2. **è°ƒç”¨ `get_contact_id_by_email()` è·å–è”ç³»äºº ID**
3. éå†æ¯æ¡ noteï¼š

```python
timestamp = int(datetime.fromisoformat(timestamp_str.replace("Z", "+00:00")).timestamp() * 1000)
```

* ç”¨ `datetime.fromisoformat()` è§£æ ISO æ ¼å¼æ—¶é—´ï¼ˆZ è¡¨ç¤º UTCï¼‰
* è½¬æˆç§’æ•°å†ä¹˜ 1000 â†’ æ¯«ç§’

---

### âœ… ç»“æœè®°å½•ï¼š

æˆåŠŸçš„é‚®ç®±è¿½åŠ åˆ° `success` åˆ—è¡¨
å¤±è´¥çš„é‚®ç®± + é”™è¯¯ä¿¡æ¯è¿½åŠ åˆ° `failed`

æœ€åè¿”å›ï¼š

```python
return {
    "msg": "æ‰¹é‡å†™å…¥å®Œæˆ",
    "success": success,
    "failed": failed
}
```

---

## ğŸ¯ æ€»ç»“æµç¨‹å›¾è§£

```
å‰ç«¯æˆ–è„šæœ¬å‘é€ POST è¯·æ±‚ JSON â†’
    FastAPI æ¥æ”¶ â†’
        éå†æ¯ä¸ªè”ç³»äºº entry â†’
            æ ¹æ® email è·å– contact_id â†’
                éå† notesï¼Œé€æ¡å†™å…¥ Noteï¼ˆåŒ…å«æ­£æ–‡ + æ—¶é—´æˆ³ï¼‰ â†’
                    æˆåŠŸ or æŠ¥é”™ â†’
                        æœ€ç»ˆè¿”å› success / failed åˆ—è¡¨
```

---

## âœ… æµ‹è¯•å‘½ä»¤è¡Œè°ƒç”¨æ–¹å¼ï¼ˆcurl ç¤ºä¾‹ï¼‰

å¦‚æœä½ å·²ç»æ”¾åœ¨ `/data/test_notes.json`ï¼Œå¯ä»¥è¿™æ ·æµ‹è¯•ï¼š

```bash
curl -X POST "http://localhost:8000/upload-notes-by-email" \
  -H "Content-Type: application/json" \
  -d @data/test_notes.json
```

æˆ–è€…ä½ ç”¨ Python å‘è¯·æ±‚ä¹Ÿè¡Œï¼Œæˆ‘å¯ä»¥å†™ä¸ª `test_upload.py` ç»™ä½ æµ‹è¯•ï½

---

éœ€è¦æˆ‘ç°åœ¨å¸®ä½ å†™ä¸€ä¸ª Python æµ‹è¯•è„šæœ¬æ¥è‡ªåŠ¨åŒ–ä¸Šä¼ å—ï¼Ÿæˆ–è€…ä½ æƒ³è®©å®ƒæ”¯æŒ `.json` æ–‡ä»¶ä¸Šä¼  + ç½‘é¡µç•Œé¢æµ‹è¯•ï¼Ÿæˆ‘éƒ½å¯ä»¥é…åˆç»§ç»­ä¼˜åŒ–ã€‚
